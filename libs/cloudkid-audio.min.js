(function(t,i,e){"use strict";var n=function(t,i){this.initialize(t,i)},a=n.prototype,s=null;a._onFocus=null,a._onBlur=null,a._onToggle=null,i.hidden!==e?s="visibilitychange":i.mozHidden!==e?s="mozvisibilitychange":i.msHidden!==e?s="msvisibilitychange":i.webkitHidden!==e&&(s="webkitvisibilitychange"),a.initialize=function(e,n){if(s){this._onBlur=n,this._onFocus=e;var a=function(){i.hidden||i.webkitHidden||i.msHidden||i.mozHidden?n():e()};i.addEventListener(s,a,!1),t.addEventListener("pagehide",n),t.addEventListener("pageshow",e),t.addEventListener("blur",n),t.addEventListener("focus",e),t.addEventListener("visibilitychange",a,!1),this._onToggle=a}},a.destroy=function(){s&&(t.removeEventListener("pagehide",this._onBlur),t.removeEventListener("pageshow",this._onFocus),t.removeEventListener("blur",this._onBlur),t.removeEventListener("focus",this._onFocus),t.addEventListener("visibilitychange",this._onToggle),i.removeEventListener(s,this._onToggle,!1),this._onFocus=null,this._onBlur=null)},namespace("cloudkid").PageVisibility=n})(window,document),function(t,i){"use strict";function e(t){return null===t?t+"":"object"==typeof t||"function"==typeof t?Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase()||"object":typeof t}var n=function(){},a=n.prototype;a._listeners=[],a.trigger=function(t,e){if(this._listeners[t]!==i)for(var n=this._listeners[t],a=0;n.length>a;a++)n[a](e)},a.on=function(t,i){if("object"===e(t))for(var n in t)t.hasOwnProperty(n)&&this.on(n,t[n]);else if("function"===e(i))for(var a=t.split(" "),s=null,r=0,o=a.length;o>r;r++)s=a[r],this._listeners[s]=this._listeners[s]||[],-1===this._callbackIndex(s,i)&&this._listeners[s].push(i);else if("array"===e(i))for(var l=0,u=i.length;u>l;l++)this.on(t,i[l]);return this},a.off=function(t,n){if(t===i)this._listeners=[];else if("array"===e(n))for(var a=0,s=n.length;s>a;a++)this.off(t,n[a]);else for(var r=t.split(" "),o=null,l=0,u=r.length;u>l;l++)if(o=r[l],this._listeners[o]=this._listeners[o]||[],n===i)this._listeners[o].length=0;else{var c=this._callbackIndex(o,n);-1!==c&&this._listeners[t].splice(c,1)}return this},a._callbackIndex=function(t,i){for(var e=0,n=this._listeners[t].length;n>e;e++)if(this._listeners[t][e]===i)return e;return-1},namespace("cloudkid").EventDispatcher=n}(window),function(t,i){"use strict";var e={};e.importSpriteMap=function(t,n){if(n.resources===i)throw"Sprite configuration must contain 'resources': an array of file types";var a=e.getPlayableURL(n.resources);if(n.spritemap===i)throw"Sprite configuration must contain 'spritemap': a dictionary of audio sprites";var s,r;for(r in n.spritemap)s=n.spritemap[r],Debug.log(r),Debug.log(s),t.setSound(r,s.start,s.end-s.start,s.loop);return a},e.supported=function(){return n};var n=function(){var t=document.createElement("audio"),i=!1;try{i=!!t.canPlayType,i&&(i={},i.ogg=t.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),i.oga=i.ogg,i.mp3=t.canPlayType("audio/mpeg;").replace(/^no$/,""),i.wav=t.canPlayType('audio/wav; codecs="1"').replace(/^no$/,""),i.caf=t.canPlayType("audio/x-caf").replace(/^no$/,""),i.m4a=(t.canPlayType("audio/x-m4a;")||t.canPlayType("audio/aac;")).replace(/^no$/,""))}catch(e){}return i}();e.canPlayURL=function(t){if(!n)return!1;var i=t.toLowerCase().match(/\.([a-z0-9]{3})(\?.*)?$/i);return i&&i.length?(i=i[1],n[i]||!1):!1},e.getPlayableURL=function(t){var i,n,a=null;if(t instanceof Array){for(i=0,n=t.length;n>i;i++)if(t[i]instanceof Object){if(e.canPlayURL(t[i].url)){a=t[i].url;break}}else if(e.canPlayURL(t[i])){a=t[i];break}}else e.canPlayURL(t)&&(a=t);return a},namespace("cloudkid").AudioUtils=e}(window),function(t,i){"use strict";var e=function(t){this.initialize(t)},n=e.prototype=new cloudkid.EventDispatcher,a=null,s=!0,r=!1,o=!1,l=!1,u=!1,c=!1,d=null,h=null,p=null,m=0,_=null,f=0,g=null,v=null,y=null,b=0,S=!1,L=null,E=null,P=null,T=null,D=null,A=-1,k=null;e.LOAD_STARTED="loadStarted",e.LOADED="loaded",e.LOAD_PROGRESS="loadProgress",e.COMPLETE="complete",e.PROGRESS="progress",e.PAUSED="paused",e.RESUMED="resumed",e.STOPPED="stopped",e.STARTED="started",e.M4A_PADDING=.1,e.VERSION="1.0.0",n.manualUpdate=!1,n.initialize=function(i){var n=cloudkid.AudioUtils;if(!n.supported())throw"HTML5 Audio is not supported!";if(null!==T)throw"SwishSprite instance is already create. Destroy before re-creating";this.clear();var o=null!==i&&"object"==typeof i?n.importSpriteMap(this,i):n.getPlayableURL(i);if(!o)throw"The supplied filetype is unsupported in this browser.";T=this,u=!1,r=!1,s=!0,c=!1,b=0,S=!1,D=new cloudkid.PageVisibility(O,C),A=-1,f=o.indexOf(".m4a")>-1?e.M4A_PADDING:0,a=t.document.createElement("audio"),a.addEventListener("canplay",U),a.addEventListener("canplaythrough",I),a.addEventListener("loadeddata",U),a.addEventListener("loadedmetadata",U),a.addEventListener("progress",U),a.addEventListener("ended",x),a.addEventListener("stalled",z),a.src=o},n.getAudioElement=function(){return a},n.mute=function(){return a.volume=0,this},n.unmute=function(){return a.volume=1,this},n.pause=function(){l=!1,d&&t.clearInterval(d),p&&t.clearTimeout(p);var i=s;return a.pause(),s=!0,i||this.trigger(e.PAUSED),this},n.resume=function(){return s&&g&&(this.play(g,a.currentTime),this.trigger(e.RESUMED)),this},n.stop=function(){return null!==g&&this.trigger(e.STOPPED),this.pause(),g=null,this},n.getLength=function(t){return t===i&&g!==i?_[g].duration:t!==i?_[t].duration:0},n.getPosition=function(){return g!==i&&_[g]!==i?a.currentTime-_[g].start:0},n.getSound=function(t){return t===i&&g!==i?_[g]:t?_[t]:i},n.setSound=function(t,i,e,n){var a=n?0:f;return _[t]={start:i-a,end:i+e+a,duration:e+2*a,loop:n},this},n.prepare=function(t){_[t]!==i&&(a.currentTime=_[t].start)},n.clear=function(){return _={},this},n.load=function(){if(!u){u=!0;try{h&&t.clearInterval(h),o=!0,this.manualUpdate||(h=t.setInterval(U,10)),a.play(),a.pause()}catch(i){}}return this},n.update=function(){o&&U(),l&&F()},n.play=function(n,r){var o;if(y=0,l=!1,t.clearInterval(d),t.clearTimeout(p),_[n]===i)return Debug.error("SoundUnknown: Sound not found. Playing sound '"+n+"' has failed."),!1;var u=_[n];o=u.start,r!==i&&r>=u.start&&u.end>r&&(o=r);try{v=!1,a.pause(),L=a.currentTime;try{a.currentTime=k=o}catch(c){Debug.error("CurrentTimeSetException: Setting the current time has failed: "+c)}if(Math.abs(a.currentTime-o)>.5)return!0;g=n,s=!1,a.play(),T.trigger(e.STARTED);var h=Math.max(0,Math.min((a.currentTime-_[g].start)/_[g].duration,1));T.trigger(e.PROGRESS,h),p=t.setTimeout(M,1e3*_[g].duration+500),l=!0,this.manualUpdate||(d=t.setInterval(F,10))}catch(c){return Debug.error("SoundPlayException: Sound Playback has failed: "+c),!1}return!0};var F=function(){var i,n=_[g];if(!v&&t.Math.abs(a.currentTime-L)>.1)v=!0,L=a.currentTime,p&&t.clearTimeout(p),i=n.end-a.currentTime,t.Math.abs(i-n.duration)>.1&&(i=n.duration),p=t.setTimeout(M,1e3*i+500);else if(S||a.currentTime===L){if(v&&S){if(a.currentTime>k){var s=Math.max(0,Math.min((a.currentTime-n.start)/n.duration,1));T.trigger(e.PROGRESS,s)}k=a.currentTime,a.currentTime>=n.end&&x()}}else S=!0,a.currentTime<n.start-.5&&(a.currentTime=n.start)};n.destroy=function(){this.manualUpdate=!1,l=!1,o=!1,d&&t.clearInterval(d),E&&t.clearInterval(E),p&&t.clearTimeout(p),h&&t.clearInterval(h),D&&_pageVisiblity.destroy(),D=null,a.removeEventListener("canplay",U),a.removeEventListener("canplaythrough",I),a.removeEventListener("loadeddata",U),a.removeEventListener("loadedmetadata",U),a.removeEventListener("progress",U),a.removeEventListener("ended",x),a.removeEventListener("stalled",z),this.off(),this.stop(),this.clear(),a=null,T=null},n.isLoaded=function(){return r};var w=function(){c||(c=!0,T.trigger(e.LOAD_STARTED),E=t.setInterval(R,1e3))},C=function(){T&&(-1==A&&(A=s?1:0),T.pause())},O=function(){T&&(0===A&&T.resume(),A=-1)},R=function(){var t=_[g];g?(a.currentTime<t.start-1||a.currentTime>t.end+1?(y+=1,Debug.warn("ScrubberOutOfRange: The scrubber position ("+a.currentTime+") is out of range ("+t.start+" - "+t.end+"). This warning reported "+y+" times."),y>=5&&(a.currentTime=t.start)):y=0,a.currentTime!==P?(b=0,P=a.currentTime):(b++,!s&&b>=5&&a.play())):(y=0,b=0)},U=function(){var n,s=0;if(a.buffered.length&&(s=a.buffered.end(a.buffered.length-1)),!c&&s>0&&a.duration>0&&w(),!r){if(n=Math.max(1,s/a.duration),isNaN(n))return;n!==m&&(m=n,T.trigger(e.LOAD_PROGRESS,m)),.001>1-n&&(o=!1,t.clearInterval(h),m=1,r=!0,_.silence!==i&&T.play("silence"),T.trigger(e.LOADED))}},M=function(){{_[g]}},I=function(){w()},z=function(){c||Debug.log("Media stalled before load started")},x=function(){var i=_[g];i&&i.loop?(T.pause(),a.currentTime=i.start,t.setTimeout(function(){T.trigger(e.PROGRESS,1),T.trigger(e.COMPLETE),g&&T.play(g)},0)):(T.stop(),T.trigger(e.PROGRESS,1),T.trigger(e.COMPLETE))};namespace("cloudkid").SwishSprite=e}(window),function(t,i,e){"use strict";var n=cloudkid.OS,a=cloudkid.SwishSprite,s=cloudkid.MediaLoader,r=function(t,i){this.initialize(t,i)},o=r.prototype,l=null,u=!1,c=null,d=null,h=null,p=null,m=!1,_=0,f=!1,g=0,v=0,y="AudioMute",b="SwishSprite",S=null,L=null;r.VERSION="1.0.0",r.init=function(t,i){return L||new r(t,i),L},Object.defineProperty(r,"instance",{get:function(){return L}}),o.initialize=function(t,i){L||(u=!1,L=this,"object"==typeof t?E(t,i):"string"==typeof t?s.instance.load(t,function(t){return t&&t.content?(E(t.content,i),e):(i(!1),e)}):i(!1))};var E=function(t,i){l=t;var n=!0;l&&l.resources===e&&(n=!1),l&&l.spritemap===e&&(n=!1),i(n)},P=function(t){if(!S)return!1;if(t!==e){if(!l||!l.spritemap)return!1;if(l.spritemap[t]===e)return!1}return!0};o.getAudioSprite=function(){return S},o.load=function(t){if(l){var i,r,o=s.instance.cacheManager,u=l.resources.length;for(i=0;u>i;i++)r=l.resources[i],l.resources[i]=o.prepare(r.url!==e?r.url:r);S=new a(l),S.manualUpdate=!0;var c=this;S.on(a.LOADED,function(){S.off(a.LOADED).on(a.PROGRESS,c._onUpdate.bind(c)).on(a.COMPLETE,c._onComplete.bind(c)),t()}),n.instance.addUpdateCallback(b,S.update),S.load()}},o.prepare=function(t){P(t)&&S.prepare(t)},o.isPlaying=function(){return!m},o.pause=function(){!m&&S&&c&&(f?this._stopSilence():S.pause(),m=!0)},o.resume=function(){m&&S&&c&&(f?this._startSilence():S.resume(),m=!1)},o.play=function(t,i,e){P(t)&&(m||this.stop(),d=t,c=l.spritemap[t],h=i||null,p=e||null,m=!1,_=0,v=0,f?this._playSilence():this._playAudio())},o._playSilence=function(){g=this.getLength(d),v=S.getPosition(),p&&p(_),this._startSilence()},o._startSilence=function(){n.instance.addUpdateCallback(y,this._updateSilence.bind(this))},o._stopSilence=function(){n.instance.removeUpdateCallback(y)},o._updateSilence=function(t){v+=t/1e3,_=v/g,g>v?p&&p(Math.min(1,Math.max(0,_))):this._onComplete()},o._playAudio=function(){p&&p(_);var t;v>0&&(t=S.getSound(d).start+v),S.play(d,t)},o._onUpdate=function(t){_=t,p&&p(_)},o._onComplete=function(){c&&(c.loop?(_=0,v=0,h&&h()):this.stop(!0))},o.stop=function(t){_=0,v=0,p=null,d=null,c=null,m=!0,g=0,this._stopSilence();var i=h;h=null,S&&S.stop(),t===e&&(t=!1),t&&null!==i&&i()},o.getLength=function(t){return l&&l.spritemap[t]!==e?l.spritemap[t].end-l.spritemap[t].start:0},o.mute=function(){f||(f=!0,S&&c&&(S.pause(),m||this._playSilence()))},o.unmute=function(){f&&(f=!1,S&&c&&(this._stopSilence(),m||this._playAudio()))},o.getMuted=function(){return f},o.isLooping=function(t){return P(t)?l.spritemap[t].loop:e},o.destroy=function(){u||(this.stop(),S&&(n.instance.removeUpdateCallback(b),S.destroy()),L=S=l=c=d=p=h=null,u=!0)},namespace("cloudkid").Audio=r}(window,document),function(t){"use strict";var i=function(t,i,e,n,a){this.initialize(t,i,e,n,a)},e=i.prototype,n=null,a=0,s=cloudkid.Audio,r=cloudkid.Captions,o=cloudkid.Animator;e._clip=null,e._visibility=null,e._audioAlias=null,e._frameLabel=null,e._animStartFrame=0,e._animEndFrame=null,e._animDuration=0,e._audioStartFrame=0,e._audioDuration=0,e._audioStarted=!1,e._animationFPS=20,e._totalLoops=1,e._currentLoop=0,e._lastProgress=0,e.paused=!1,e._animation=null,e._playCompleteCallback=null,e._audioDone=!1,e._animDone=!1,e._syncDiff=2,e._handleCaptions=!1,e._captionUpdate=null,e.initialize=function(i,e,r,o,l){this._clip=i,this._audioAlias=e,this._frameLabel=r===t?null:r,this._totalLoops=o===t?1:o,null!==this._frameLabel?(this._animStartFrame=this._clip.timeline.resolve(this._frameLabel),1==this._totalLoops?(this._animEndFrame=this._clip.timeline.resolve(this._frameLabel+"_stop"),this._animEndFrame===t&&(this._animEndFrame=this._clip.timeline.resolve(this._frameLabel+"_loop"))):(this._animEndFrame=this._clip.timeline.resolve(this._frameLabel+"_loop"),this._animEndFrame===t&&(this._animEndFrame=this._clip.timeline.resolve(this._frameLabel+"_stop")))):this._animEndFrame=this._clip.timeline.duration-1,this._audioStartFrame=l===t?this._animStartFrame:l,this._animDuration=this._animEndFrame-this._animStartFrame,null===n&&(n=s.instance),a++,this._animationFPS=createjs.Ticker.getFPS(),this._audioDuration=Math.round(n.getLength(this._audioAlias)*this._animationFPS),this._audioDuration!=this._animDuration&&n.isLooping(this._audioAlias)&&Debug.warn("The sound '"+this._audioAlias+"' and animation '"+this._frameLabel+"' aren't the same length (sound: "+this._audioDuration+", animation: "+this._animDuration+")");var u=this,c=-1;this._visibility=new cloudkid.PageVisibility(function(){0===c&&u._animation&&u._animation.setPaused(!1),c=-1},function(){-1===c&&(c=u.paused?1:0),u._animation&&u._animation.setPaused(!0)})},e.play=function(i){n.stop(),this._playCompleteCallback=i!==t?i:null,this._currentLoop=1,this._handleCaptions=r&&r.instance&&r.instance.hasCaption(this._audioAlias),this._captionUpdate=this._handleCaptions?r.instance.run(this._audioAlias):null,this._startPlayback()},e._startPlayback=function(){this._animation=null,this._lastProgress=0,this._audioDone=!1,this._animDone=!1,this.paused=!1,this._audioStartFrame<=this._animStartFrame+this._syncDiff?(this._audioStarted=!0,this._animation=o.play(this._clip,this._frameLabel,this._animationFinished.bind(this),null,!0),n.play(this._audioAlias,this._audioFinished.bind(this),this._update.bind(this))):(this._clip.timeline.addEventListener("change",this._onFrameUpdate.bind(this)),n.prepare(this._audioAlias),this._audioStarted=!1,this._animation=o.play(this._clip,this._frameLabel,this._animationFinished.bind(this),null,!0))},e._audioFinished=function(){!this._animDone&&this._animation&&this._animation.getPaused()&&this._animation.setPaused(!1),this._audioDone=!0,this._doneCheck()},e._animationFinished=function(){this._animation&&(this._animation.onComplete=null),this._animDone=!0,this._doneCheck()},e.pause=function(){this.paused||(this.paused=!0,n.pause(),this._animation&&this._animation.setPaused(!0))},e.resume=function(){this.paused&&(this.paused=!1,n.resume(),this._animation&&this._animation.setPaused(!1))},e.stop=function(i){n.stop(),o.stop(this._clip),this.paused=!0,this._animation=null,i=i===t?!1:i,this._playCompleteCallback&&i&&this._playCompleteCallback(),this._playCompleteCallback=null},e._doneCheck=function(){if(this._animDone&&this._audioDone){var t=0===this._totalLoops;t||this._totalLoops>1?t||this._currentLoop<this._totalLoops?(o.stop(this._clip),this._currentLoop++,this._startPlayback()):this.stop(!0):this.stop(!0)}},e._update=function(t){if(!this.paused&&(this._captionUpdate&&this._captionUpdate(t),t>this._lastProgress)){if(1==t&&0===this._lastProgress)return;if(this._lastProgress=t,this._animDone)return;var i=parseInt(this._audioStartFrame,10)+Math.round(this._audioDuration*this._lastProgress),e=this._clip.timeline.position;i>e?(this._animation.getPaused()&&this._animation.setPaused(!1),i>this._animEndFrame?this._animationFinished():this._clip.gotoAndPlay(i)):e>i+this._syncDiff&&1!=this._lastProgress&&this._animation.setPaused(!0)}},e._onFrameUpdate=function(){!this._audioStarted&&this._clip.timeline.position>=this._audioStartFrame&&(this._audioStarted=!0,n.play(this._audioAlias,this._audioFinished.bind(this),this._update.bind(this)),this._clip.timeline.removeAllEventListeners())},e.destroy=function(){a--,0===a&&(n=null),this._visibility&&this._visibility.destroy(),this._visibility=this._clip=this._audioAlias=this._totalLoops=this._frameLabel=this._animStartFrame=this._animEndFrame=this._animDuration=this._totalLoops=this._currentLoop=this._lastProgress=this._animation=null},namespace("cloudkid").AudioAnimation=i}();