(function(e){if(!("namespace"in e)){var t=function(e){for(var t=e.split("."),n=window,i="",s=0,a=t.length;a>s;s++)i=t[s],n[i]=n[i]||{},n=n[i];return n};e.namespace=t}})(window),function(e,t){function n(e,t){i.output&&i.output.append('<div class="'+e+'">'+t+"</div>")}var i=function(){},s=e.console!==t;i.GENERAL=0,i.DEBUG=1,i.INFO=2,i.WARN=3,i.ERROR=4,i.minLogLevel=i.GENERAL,i.enabled=!0,i.output=null,i._NET_PORT=1025,i._isConnected=!1,i._socket=null,i._messageObj=null,i._messageQueue=null,i.connect=function(t){if(!("WebSocket"in e||"MozWebSocket"in e))return!1;e.WebSocket=WebSocket||MozWebSocket;try{var n=i._socket=new WebSocket("ws://"+t+":"+i._NET_PORT);n.onopen=a,n.onmessage=function(){},n.onclose=r,n.onerror=r,i._messageQueue=[],i._isConnected=!0}catch(s){return!1}return!0},i.disconnect=function(){i._isConnected&&(i._socket.close(),r())};var a=function(){window.onerror=o,i._messageObj={level:"session",message:""},i._socket.send(JSON.stringify(i._messageObj));for(var e=0;i._messageQueue.length>e;++e)i._socket.send(JSON.stringify(i._messageQueue[e]));i._messageQueue=null},o=function(e,t,n){return i.remoteLog("Error: "+e+" in "+t+" at line "+n,"ERROR"),!1},r=function(){window.onerror=null,i._isConnected=!1;var e=i._socket;e.onopen=null,e.onmessage=null,e.onclose=null,e.onerror=null,i._socket=null,i._messageObj=null,i._messageQueue=null};i.remoteLog=function(e,t){t||(t="GENERAL"),i._messageQueue?i._messageQueue.push({message:e,level:t}):(i._messageObj.level=t,i._messageObj.message=e,i._socket.send(JSON.stringify(i._messageObj)))},i.log=function(e){i.enabled&&(i._isConnected?i.remoteLog(e,"GENERAL"):i.minLogLevel==i.GENERAL&&s&&(console.log(e),n("general",e)))},i.debug=function(e){i.enabled&&(i._isConnected?i.remoteLog(e,"DEBUG"):i.minLogLevel<=i.DEBUG&&s&&(console.debug(e),n("debug",e)))},i.info=function(e){i.enabled&&(i._isConnected?i.remoteLog(e,"INFO"):i.minLogLevel<=i.INFO&&s&&(console.info(e),n("info",e)))},i.warn=function(e){i.enabled&&(i._isConnected?i.remoteLog(e,"WARNING"):i.minLogLevel<=i.WARN&&s&&(console.warn(e),n("warn",e)))},i.error=function(e){i.enabled&&(i._isConnected?i.remoteLog(e,"ERROR"):s&&(console.error(e),n("error",e)))},i.assert=function(e,t){s&&i.enabled&&console.assert&&(console.assert(e,t),e||n("error",t))},i.dir=function(e){i.minLogLevel==i.GENERAL&&s&&i.enabled&&console.dir(e)},i.clear=function(){s&&i.enabled&&(console.clear(),i.output&&i.output.html(""))},i.trace=function(e){i.minLogLevel==i.GENERAL&&s&&i.enabled&&console.trace(e)},e.Debug=i}(window),function(e){var t=function(){},n=t.prototype=new createjs.Container,i=!1,s=!1,a=null,o=null,r=0,l=0,u=null,c=0,d=null;t.VERSION="1.0.0",t._instance=null,n.Container_initialize=n.initialize,n.stage=null,n._renderer=null,n._app=null;n.options=null,n._updateFunctions={},t.init=function(e,n){return t._instance||(t._instance=new t,t._instance.initialize(e,n)),t._instance},n.initialize=function(t,n){this.Container_initialize(),this.options=n||{},this.options.parseQueryString!==e&&(this.options=h(this.options)),this.options.debug!==e&&(Debug.enabled=this.options.debug===!0||"true"===this.options.debug),this.options.minLogLevel!==e&&(Debug.minLogLevel=parseInt(this.options.minLogLevel,10)),"string"==typeof this.options.ip&&Debug.connect(this.options.ip);var i=cloudkid.MediaLoader.init();this.stage=new createjs.Stage(t),this.stage.name="cloudkid.OS",this.stage.canvas.onmousedown=function(e){e.preventDefault()},this.stage.addChild(this);a=new createjs.Text("","10px Arial","#000"),a.x=a.y=5;var r=new createjs.Graphics;r.beginFill("#fff"),r.drawRect(0,0,70,20),o=new createjs.Shape(r),o.alpha=.9,o.visible=a.visible=this.options.showFramerate||!1;var l=window.hasOwnProperty("ontouchstart");if(-1==window.navigator.userAgent.indexOf("MSIE 10.0")||l?createjs.Touch.enable(this.stage):Debug.log("IE10 Desktop"),d=this.tick.bind(this),this.tick(),this.stage.autoClear=!!this.options.clearView||!1,createjs.Ticker.useRAF=this.options.raf||!0,createjs.Ticker.setFPS(this.options.fps||60),this.removeApp(),this.options.versionsFile!==e){s=!1;var u=this;i.cacheManager.addVersionsFile(this.options.versionsFile,function(){s=!0,u._app&&(u.addChildAt(u._app,0),u._app.init(),u.resume())})}else s=!0};var h=function(e){var t=window.location.href,n=t.indexOf("?");if(-1==n)return e;var i=0>n?"":t.substr(n+1),s=i.indexOf("#");i=0>s?i:i.substring(0,s);var a,o=i.split("&");for(var r in o)a=o[r].split("="),e[a[0]]=a[1];return e};n.pause=function(){createjs.Ticker.removeEventListener("tick",d),i=!0};n.resume=function(){createjs.Ticker.removeEventListener("tick",d),createjs.Ticker.addEventListener("tick",d),i=!1,l=r=createjs.Ticker.getTime()},n.removeApp=function(e){var t=!1;return this._app&&(this.contains(this._app)&&this.removeChild(this._app),this._app.destroy(),Debug.log("before removeChildren: "+this.stage),this.stage.removeAllChildren(),Debug.log("after removeChildren: "+this.stage),t=!0),this.stage.addChild(this),this.stage.addChild(o),this.stage.addChild(a),this._app=null,this.pause(),r=l=u=c=0,a.text="FPS: 0.000",this.stage.update(),t},n.addApp=function(e){if(this.removeApp(),!(e instanceof cloudkid.Application))throw Error("Can only objects that inherit cloudkid.Application");this._app=e,s&&(this.addChild(e),this._app.init(),this.resume())},n.getApp=function(){return this._app},n.addUpdateCallback=function(t,n){this._updateFunctions[t]===e&&(this._updateFunctions[t]=n)},n.removeUpdateCallback=function(t){this._updateFunctions[t]!==e&&delete this._updateFunctions[t]},n.tick=function(e){if(!i){var t,n;this.stage.update(),c++,t=e?e.delta:0,n=e?e.time-l:0,n>1e3&&(u=1e3/(n/c),a&&a.visible&&(a.text="FPS: "+Math.round(1e3*u)/1e3),l=e.time,c=0),this._app&&this._app.update(t);for(var s in this._updateFunctions)this._updateFunctions[s](t)}},n.destroy=function(){var e=cloudkid.MediaLoader.instance;this.pause(),this.removeApp(),t._instance=null,createjs.Touch.disable(this.stage),e.destroy(),this.stage=null,this._updateFunctions=null},Object.defineProperty(t,"instance",{get:function(){if(!t._instance)throw"Call cloudkid.OS.init(canvasId)";return t._instance}}),namespace("cloudkid").OS=t}(),function(){Function.prototype.bind||(Function.prototype.bind=function(e){var t=this;if("function"!=typeof t)throw new TypeError;var n=Array.prototype.slice.call(arguments,1),i=function(){if(this instanceof i){var s=function(){};s.prototype=t.prototype;var a=new s,o=t.apply(a,n.concat(Array.prototype.slice.call(arguments)));return Object(o)===o?o:a}return t.apply(e,n.concat(Array.prototype.slice.call(arguments)))};return i})}(),function(){var e,t=function(){this.initialize()};e=t.prototype=new createjs.Container,e.init=function(){},e.update=function(){},e.destroy=function(){},e.resize=function(){},namespace("cloudkid").Application=t}(),function(){var e=function(){},t=e.prototype;e.PRIORITY_HIGH=1,e.PRIORITY_NORMAL=0,e.PRIORITY_LOW=-1,t.url=null,t.data=null,t.callback=null,t.priority=0,t.progress=0,t.updateCallback=null,t.toString=function(){return"[LoaderQueueItem(url:'"+this.url+"', priority:"+this.priority+")]"},t.destroy=function(){this.callback=null,this.updateCallback=null,this.data=null},namespace("cloudkid").LoaderQueueItem=e}(),function(){var e=function(){},t=e.prototype;e._instance=null;var n=null,s=null,a=null,o=0,r=null;t._canLoad=!0,t.maxSimultaneousLoads=2,t.cacheManager=null,e.init=function(){return e._instance||(e._instance=new e,e._instance._initialize()),e._instance},Object.defineProperty(e,"instance",{get:function(){if(!e._instance)throw"Call cloudkid.MediaLoader.init()";return e._instance}}),t.destroy=function(){e._instance=null,this.cacheManager&&this.cacheManager.destroy(),this.cacheManager=null,n=null},t._initialize=function(){n=[],s={},a={},r={},this.cacheManager=new cloudkid.CacheManager},t.load=function(e,t,i,s,a){var o=new cloudkid.LoaderQueueItem;o.url=e,o.callback=t,o.updateCallback=i||null,o.priority=s||cloudkid.LoaderQueueItem.PRIORITY_NORMAL,o.data=a||null,n.push(o),n.sort(function(e,t){return e.priority-t.priority}),this._tryNextLoad()},t._onLoadFailed=function(e,t){Debug.error("Unable to load file: "+e.url+" - reason: "+t.error);var i=a[e.url];i.removeAllEventListeners(),i.close(),delete s[e.url],delete a[e.url],r[e.url]?r[e.url]++:r[e.url]=1,r[e.url]>3?this._loadDone(e,null):(o--,n.push(e),this._tryNextLoad())},t._onLoadProgress=function(e,t){e.progress=t.progress,e.updateCallback&&e.updateCallback(e.progress)},t._onLoadCompleted=function(e,t){var n=a[e.url];n.removeAllEventListeners(),n.close(),delete s[e.url],delete a[e.url],this._loadDone(e,new cloudkid.MediaLoaderResult(t.result,e.url,n))},t._tryNextLoad=function(){if(!(o>this.maxSimultaneousLoads-1||0===n.length)){o++;var e=n.shift();s[e.url]=e;var t=new createjs.LoadQueue(!0);createjs.Sound&&t.installPlugin(createjs.Sound),a[e.url]=t,t.addEventListener("fileload",this._onLoadCompleted.bind(this,e)),t.addEventListener("error",this._onLoadFailed.bind(this,e)),t.addEventListener("fileprogress",this._onLoadProgress.bind(this,e));var i=this.cacheManager.prepare(e.url);t.loadFile(e.data?{id:e.data.id,src:i,data:e.data}:i)}},t._loadDone=function(e,t){o--,e.callback(t),e.destroy(),this._tryNextLoad()},t.cancel=function(e){var t=s[e],r=a[e];if(t&&r)return r.close(),delete a[e],delete s[t.url],o--,t;for(i=0;len>i;i++)if(t=n(i),t.url==e)return n.splice(i,1),t;return null},namespace("cloudkid").MediaLoader=e}(),function(){var e=function(e,t,n){this.content=e,this.url=t,this.loader=n},t=e.prototype;t.content=null,t.url=null,t.loader=null,t.toString=function(){return"[MediaLoaderResult('"+this.url+"')]"},t.destroy=function(){this.callback=null,this.url=null,this.content=null},namespace("cloudkid").MediaLoaderResult=e}(),function(e){var t=function(){this.initialize()},n=t.prototype={};n._versions=null,n.cacheBust=!1,n.initialize=function(){this._versions=[];var e=cloudkid.OS.instance.options.cacheBust;this.cacheBust=e?"true"===e||e===!0:!1},n.destroy=function(){this._versions=null},n.addVersionsFile=function(t,n,i){Debug.assert(/^.*\.txt$/.test(t),"The versions file must be a *.txt file");var s=cloudkid.MediaLoader.instance;if(this.cacheBust)return n&&n(),e;this.addVersion(t,Math.round(1e5*Math.random()));var a=this;s.load(t,function(e){if(e&&e.content){var t,s,o=e.content.replace(/\r/g,"").split("\n");for(t=0;o.length>t;t++)o[t]&&(s=o[t].split(" "),2==s.length&&a.addVersion((i||"")+s[0],s[1]))}n&&n()})},n.addVersion=function(e,t){var n=this._getVersionByUrl(e);n||this._versions.push({url:e,version:t})},n._getVersionByUrl=function(e){var t,n=this._versions.length;for(t=0;n>t;t++)if(e==this._versions[t].url)return this._versions[t];return null},n.prepare=function(t){var n=this._getVersionByUrl(t);this.cacheBust&&/(\?|\&)cb\=[0-9]*/.test(t)===!1?(this._cbVal||(this._cbVal=""+(new Date).getTime()),t=t+(0>t.indexOf("?")?"?":"&")+"cb="+this._cbVal):n&&/(\?|\&)v\=[0-9]*/.test(t)===!1&&(t=t+(0>t.indexOf("?")?"?":"&")+"v="+n.version);var i=cloudkid.OS.instance.options.basePath;return/^http(s)?\:/.test(t)===!1&&i!==e&&-1==t.search(i)&&(t=i+t),t},namespace("cloudkid").CacheManager=t}(),function(){var e=function(e,t){this.initialize(e,t)},t=e.prototype={};t._updateCallback=null,t._mouseDownEvent=null,t.draggedObj=null,t._dragOffset=null,t.dragStartThreshold=20,t._mouseDownStagePos=null,t.isTouchMove=!1,t.isHeldDrag=!1,t.isStickyClick=!1,t._theStage=null,t._dragStartCallback=null,t._dragEndCallback=null,t._triggerHeldDragCallback=null,t._triggerStickyClickCallback=null,t._stageMouseUpCallback=null,t._draggableObjects=null,t.initialize=function(e,t){this._updateCallback=this._updateObjPosition.bind(this),this._triggerHeldDragCallback=this._triggerHeldDrag.bind(this),this._triggerStickyClickCallback=this._triggerStickyClick.bind(this),this._stageMouseUpCallback=this._stopDrag.bind(this),this._theStage=cloudkid.OS.instance.stage,this._dragStartCallback=e,this._dragEndCallback=t,this._draggableObjects=[],this._mouseDownStagePos={x:0,y:0}},t.startDrag=function(e,t){this._objMouseDown(t,e)},t._objMouseDown=function(e,t){null===this.draggedObj&&(this.draggedObj=t,createjs.Tween.removeTweens(this.draggedObj),this._dragStartCallback(this.draggedObj),this._dragOffset=this.draggedObj.globalToLocal(e.stageX,e.stageY),this._dragOffset=this.draggedObj.localToLocal(this._dragOffset.x,this._dragOffset.y,this.draggedObj.parent),this._dragOffset.x-=this.draggedObj.x,this._dragOffset.y-=this.draggedObj.y,e?"touchstart"==e.nativeEvent.type?(this.isTouchMove=!0,this.isHeldDrag=!0,this._startDrag()):(this._mouseDownEvent=e,this._mouseDownStagePos.x=e.stageX,this._mouseDownStagePos.y=e.stageY,this._mouseDownEvent.addEventListener("mousemove",this._triggerHeldDragCallback),this._mouseDownEvent.addEventListener("mouseup",this._triggerStickyClickCallback)):(this.isHeldDrag=!0,this._startDrag()))},t._triggerStickyClick=function(){this.isStickyClick=!0,this._mouseDownEvent.removeAllEventListeners(),this._mouseDownEvent=null,this._startDrag()},t._triggerHeldDrag=function(e){var t=e.stageX-this._mouseDownStagePos.x,n=e.stageY-this._mouseDownStagePos.y;t*t+n*n>=this.dragStartThreshold*this.dragStartThreshold&&(this.isHeldDrag=!0,this._mouseDownEvent.removeAllEventListeners(),this._mouseDownEvent=null,this._startDrag())},t._startDrag=function(){this._theStage.removeEventListener("stagemousemove",this._updateCallback),this._theStage.addEventListener("stagemousemove",this._updateCallback),this._theStage.removeEventListener("stagemouseup",this._stageMouseUpCallback),this._theStage.addEventListener("stagemouseup",this._stageMouseUpCallback)},t.stopDrag=function(e){this._stopDrag(null,e===!0)},t._stopDrag=function(e,t){t!==!1&&this._dragEndCallback(this.draggedObj),null!==this._mouseDownEvent&&(this._mouseDownEvent.removeAllEventListeners(),this._mouseDownEvent=null),this._theStage.removeEventListener("stagemousemove",this._updateCallback),this._theStage.removeEventListener("stagemouseup",this._stageMouseUpCallback),this.draggedObj=null,this.isTouchMove=!1,this.isStickyClick=!1,this.isHeldMove=!1},t._updateObjPosition=function(e){if(this.isTouchMove||this._theStage.mouseInBounds){var t=this.draggedObj.parent.globalToLocal(e.stageX,e.stageY),i=this.draggedObj._dragBounds;this.draggedObj.x=n(t.x-this._dragOffset.x,i.x,i.right),this.draggedObj.y=n(t.y-this._dragOffset.y,i.y,i.bottom)}};var n=function(e,t,n){return t>e?t:e>n?n:e},i=function(){this.addEventListener("mousedown",this._onMouseDownListener),this.cursor="pointer"},s=function(){this.removeEventListener("mousedown",this._onMouseDownListener),this.cursor=null},a=function(e){this._dragMan._objMouseDown(e,this)};t.addObject=function(e,t){t||(t={x:0,y:0,width:this._theStage.canvas.width,height:this._theStage.canvas.height}),t.right=t.x+t.width,t.bottom=t.y+t.height,e._dragBounds=t,this._draggableObjects.indexOf(e)>=0||(e.enableDrag=i,e.disableDrag=s,e._onMouseDownListener=a.bind(e),e._dragMan=this,this._draggableObjects.push(e))},t.removeObject=function(e){e.disableDrag(),delete e.enableDrag,delete e.disableDrag,delete e._onMouseDownListener,delete e._dragMan,delete e._dragBounds;var t=this._draggableObjects.indexOf(e);t>=0&&this._draggableObjects.splice(t,1)},t.destroy=function(){null!==this.draggedObj&&(this._mouseDownEvent.removeAllEventListeners(),this._mouseDownEvent=null,this._theStage.removeEventListener("stagemousemove",this._updateCallback),this.draggedObj=null),this._updateCallback=null,this._dragStartCallback=null,this._dragEndCallback=null,this._triggerHeldDragCallback=null,this._triggerStickyClickCallback=null,this._stageMouseUpCallback=null,this._theStage=null;for(var e=this._draggableObjects.length-1;e>=0;--e){var t=this._draggableObjects[e];t.disableDrag(),delete t.enableDrag,delete t.disableDrag,delete t._onMouseDownListener,delete t._dragMan,delete t._dragBounds}this._draggableObjects=null},namespace("cloudkid").DragManager=e}();