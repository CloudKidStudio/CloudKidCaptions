!function(){function t(t){var i=t.lastIndexOf("."),e=parseInt(t.substr(i+1),10),n=t.substr(0,i).split(":"),s=36e5*parseInt(n[0],10),a=6e3*parseInt(n[1],10),r=1e3*parseInt(n[2],10);return s+a+r+e}var i,e,n=function(t,n){i=cloudkid.Audio,e=cloudkid.OS,this.initialize(t,n)},s=n.prototype;s._captionDict=null,s._textField=null,s._completeCallback=null,s._lines=null,s._currentDuration=0,s._currentTime=0,s._currentLine=-1,s._lastActiveLine=-1,s._playing=!1;var a=null,r=!1;s._isSlave=!1,s.textIsProp=!0,s._animTimeline=null,s._isDestroyed=!1,s._boundUpdate=null,s._boundComplete=null,n.VERSION="1.1.0",n.init=function(t,i){a=new n(t,i)},Object.defineProperty(n,"instance",{get:function(){return a}}),s.initialize=function(t,i){this._lines=[],this.setDictionary(t||null),this.setTextField(i),this._boundUpdate=this._updatePercent.bind(this),this._boundComplete=this._onSoundComplete.bind(this)},n.setMuteAll=function(t){r=t,a&&a._updateCaptions()},n.getMuteAll=function(){return r},s.setDictionary=function(i){if(this._captionDict=i,i){var e=/[0-9]+\:[0-9]{2}\:[0-9]{2}\.[0-9]{3}/;for(var n in i){var s=Array.isArray(i[n])?i[n]:i[n].lines;if(s)for(var a=0,r=s.length;r>a;++a){var l=s[a];"string"==typeof l.start&&(l.start=e.test(l.start)?t(l.start):parseInt(l.start,10)),"string"==typeof l.end&&(l.end=e.test(l.end)?t(l.end):parseInt(l.end,10))}else Debug.log("alias '"+n+"' has no lines!")}}},s.setTextField=function(t){this._textField&&(this.textIsProp?this._textField.text="":this._textField.setText("")),this._textField=t||null},s.hasCaption=function(t){return this._captionDict?!!this._captionDict[t]:!1},s._load=function(t){return this._isDestroyed?void 0:(this._reset(),t?(this._lines=t.lines,void 0):(this._lines=null,void 0))},s._reset=function(){this._currentLine=-1,this._lastActiveLine=-1},s.isPlaying=function(){return this._playing},s._getTotalDuration=function(){var t=this._lines;return t?t[t.length-1].end:0},Object.defineProperty(s,"currentDuration",{get:function(){return this._currentDuration}}),Object.defineProperty(s,"isSlave",{get:function(){return this._isSlave},set:function(t){this._isSlave=t}}),s.play=function(t,e){return this.stop(),this._completeCallback=e,this._playing=!0,this._load(this._captionDict[t]),this._isSlave?this._currentDuration=this._getTotalDuration():(this._currentDuration=1e3*i.instance.getLength(t),i.instance.play(t,this._boundComplete,null,this._boundUpdate)),this.seek(0),this._isSlave?this._boundUpdate:void 0},s.run=function(t){if(!this._isSlave)throw"Captions.isSlave needs to be set to tru to use run";return this.play(t)},s.runWithAnimation=function(t){t.soundAlias&&(this.stop(),this._animTimeline=t,this._load(this._captionDict[t.soundAlias]),e.instance.addUpdateCallback("CK_Captions",this._updateToAnim.bind(this)))},s._onSoundComplete=function(){var t=this._completeCallback;this.stop(),t&&t()},s.stop=function(){!this._isSlave&&this._playing&&(i.instance.stop(),this._playing=!1),this._animTimeline&&(this._animTimeline=null,e.instance.removeUpdateCallback("CK_Captions")),this._lines=null,this._completeCallback=null,this._reset(),this._updateCaptions()},s.seek=function(t){var i=this._currentTime=t,e=this._lines;if(!e)return this._updateCaptions(),void 0;if(i<e[0].start)return currentLine=this._lastActiveLine=-1,this._updateCaptions(),void 0;for(var n=e.length,s=0;n>s;s++){if(i>=e[s].start&&i<=e[s].end){this._currentLine=this._lastActiveLine=s,this._updateCaptions();break}i>e[s].end&&(this._lastActiveLine=s,this._currentLine=-1)}},s._updateToAnim=function(){!this._animTimeline||!this._animTimeline.playSound&&!this._animTimeline.soundInst||this._animTimeline.soundInst&&!this._animTimeline.soundInst.isValid?this.stop():this._animTimeline.soundInst&&this.seek(this._animTimeline.soundInst.position)},s._updatePercent=function(t){this._isDestroyed||(this._currentTime=t*this._currentDuration,this._calcUpdate())},s.updateTime=function(t){this._isDestroyed||(this._currentTime+=t,this._calcUpdate())},s._calcUpdate=function(){var t=this._lines;if(t){var i=t.length,e=this._lastActiveLine+1,n=i-1,s=this._currentTime;s>=t[n].end?(this._currentLine=-1,this._updateCaptions()):n>=e&&s>=t[e].start&&s<=t[e].end?(this._currentLine=this._lastActiveLine=e,this._updateCaptions()):-1!=this._currentLine&&s>t[this._currentLine].end&&(this._lastActiveLine=this._currentLine,this._currentLine=-1,this._updateCaptions())}},s._updateCaptions=function(){if(this._textField){var t=-1==this._currentLine||r?"":this._lines[this._currentLine].content;this.textIsProp?this._textField.text=t:this._textField.setText(t)}},s.destroy=function(){this._isDestroyed||(this._isDestroyed=!0,a===this&&(a=null),this._captionDict=null,this._lines=null)},namespace("cloudkid").Captions=n}();